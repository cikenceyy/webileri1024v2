# Risk Register

| ID | Kategori | Açıklama | Dosya / Örnek | Şiddet | Önerilen Çözüm | İlgili Komut |
| --- | --- | --- | --- | --- | --- | --- |
| R-001 | Rota Çakışması | Marketing (eski `crmsales`) rotalarında `customers.show` hem resource hem özel rota ile tanımlı; ileride slug refactor'larında çakışma riski doğurur. | `app/Modules/Marketing/Routes/admin.php` | P2 | Resource rotalarını slug bazlı yeniden yaz, duplicate show rotasını kaldır veya redirect et. | Komut 3 |
| R-002 | Rota Çakışması | `admin/procurement/pos` URI'si ile `admin/finance/ap` rotaları benzer; otomatik discovery sırasında isim çakışması olabilir. | `app/Modules/Procurement/Routes/admin.php` | P3 | URI'ları `purchase-orders` ve `ap/payables` olarak standardize et. | Komut 3 |
| R-003 | Blade Path Kırılması | Layout ve partial'lar `resources/views/partials/*` altında; yeni yapılandırmada taşınırken @include path'leri bozulabilir. | `resources/views/layouts/admin.blade.php` | P1 | Taşıma sırasında `view()->addNamespace()` veya otomatik alias tanımla; docs/Inventory/BladeInventory rehberini takip et. | Komut 2 |
| R-004 | SCSS Import Sırası | Bootstrap importu öncesi CSS değişkenleri `resources/scss/app.scss` içinde set ediliyor; `to-rgb()` hatası oluşabilir. | `resources/scss/app.scss` | P2 | CSS değişkenlerini Bootstrap sonrasına taşı, literal renk override'ları koru. | Komut 2 |
| R-005 | SoftDeletes | Inventory/Finance/Marketing/Logistics modellerinde SoftDeletes aktif; tek DB + audit planı ile çelişiyor. | `app/Modules/**/Domain/Models/*` | P1 | SoftDeletes'i kaldır, `status`/`voided_at` alanları ekle; migration'lar Komut 4'te hazırlanacak. | Komut 4 |
| R-006 | company_id Eksikliği | `App\Models\User` global scope kullanmıyor; tenant izolasyonu açıkta kalabilir. | `app/Models/User.php` | P1 | `BelongsToCompany` benzeri trait ekle, login sırasında scope uygula. | Komut 1 |
| R-007 | Seeder Prod Riski | `LocalTenantSeeder` default olarak üç şirket ve kullanıcı oluşturuyor; production'da yanlışlıkla çalışırsa veri kirliliği. | `database/seeders/LocalTenantSeeder.php` | P2 | Seeder'ı `app()->environment('local')` koşulu ile koru veya ServiceProvider'da devre dışı bırak. | Komut 5 |
| R-008 | Spatie Scope | Spatie Permission team scope `company_id`; tenant switcher yoksa role cache yanlış şirketle paylaşılabilir. | `config/permission.php`, `app/Core/Traits/BelongsToCompany.php` | P2 | PermissionRegistrar'da `setPermissionsTeamId` hooking; middleware ile company context set et. | Komut 1 |
| R-009 | Blade Component Dağılımı | UI bileşenleri tek klasörde; modül taşırken referanslar kırılabilir. | `resources/views/components/ui-*.blade.php` | P2 | Component alias haritası (`View::componentNamespace`) ekle; taşıma planı Komut 2'de uygulanacak. | Komut 2 |
| R-010 | Konsol Asset Yükü | `resources/js/app.js` tüm modül script'lerini global yüklüyor; konsol ekranları gereksiz JS taşıyor. | `resources/js/app.js` | P1 | Modül bazlı dynamic import ve entry discovery ekle. | Komut 3 |
| R-011 | Migration Normalize | `database/migrations/2025_01_01_010600_normalize_company_indexes.php` company indexleri düzenliyor; modül migrationlarıyla çakışma riski var. | `database/migrations/2025_01_01_010600_normalize_company_indexes.php` | P3 | Komut 4 sırasında migration sıralaması kontrol edilerek idempotent hale getirilecek. | Komut 4 |
| R-012 | Console View Namespace | Konsol Blade'leri `resources/views/core/consoles/*`; modül taşınırken yeni namespace bulunmazsa `view()` çağrıları bozulur. | `routes/admin.php` (Today Board) | P2 | ViewServiceProvider ile `view()->addNamespace('consoles', ...)` tanımla. | Komut 3 |


# Clean Laravel Cloud config (no quotes, LF endings)
name: webileri

build:
  commands:
    - composer install --no-dev --prefer-dist --optimize-autoloader
    - npm ci
    - npm run build
    - php artisan config:cache
    - php artisan route:cache
    - php artisan view:cache

deploy:
  commands:
    - php artisan migrate --force

processes:
  - name: queue
    command: php artisan queue:work --sleep=1 --tries=1
    quantity: 1
    env:
      QUEUE_CONNECTION: redis
      CACHE_STORE: redis
      SESSION_DRIVER: redis

scheduled:
  - cron: "* * * * *"
    command: php artisan schedule:run
    env:
      QUEUE_CONNECTION: redis

# Attach resources (fill IDs/names in Cloud UI; this is descriptive)
resources:
  database: "<cloud-db-id>"
  kv: "<cloud-kv-id>"
  object_storage: "<cloud-r2-bucket-id>"
